clear all; 
load 'sift_desc.mat';
load 'gs.mat';

% K=25;
% K=50;
% K=100;
% K=200;
% K=400;
% K=800;
K=1600;

img_sift_total=[];
for i=1:1888
    idx_sift = randsample(size(train_D{i}, 2), 10); 
    img_sift=train_D{i}(:, idx_sift);
    img_sift_total=[img_sift_total; img_sift'];
end

img_sift_total=double(img_sift_total);
C=kmeans_cluster(img_sift_total,K);

train_matrix=[];
for i=1:1888
    sift_dist = pdist2(C,double(train_D{i})','euclidean'); 
    [d, ind]=sort(sift_dist,1);
    train_matrix=[train_matrix; hist(ind(1, :),1:K)];
end


test_matrix=[];
for i=1:800
    sift_dist = pdist2(C,double(test_D{i})','euclidean'); 
    [d, ind]=sort(sift_dist,1);
    test_matrix=[test_matrix; hist(ind(1, :),1:K)];
end

output = knn(test_matrix, train_matrix, train_gs);
c = confusionmat(test_gs, output)

acc = 100 * sum(diag(c)) / 800

% ===================================================
% 
% K=25
% 
% c =
% 
%     54     0    23     0     4    12     3     4
%      0    84     0     3     5     0     4     4
%     30     0    40     3     8    11     6     2
%      5     8     3    45     5     5    16    13
%      9     3     4     5    50    17    11     1
%     20     4     5     0    10    49     9     3
%      1     2     1    11    12     7    58     8
%      7     3     3    13    10    15     8    41
% 
% 
% acc =
% 
%    52.6250
% 
% ===================================================
% 
% K=50
% 
% c =
% 
%     60     1    17     0     6    14     2     0
%      0    88     0     0     5     1     4     2
%     37     1    39     2     4    10     5     2
%      3    11     2    53     1     6    15     9
%      5     7     1     0    44    27    11     5
%     16     3     5     1    13    49     8     5
%      4     3     3    11    10     9    58     2
%     12     3     3    11    10    14    14    33
% 
% 
% acc =
% 
%     53
% 
% ===================================================
% 
% K=100
% 
% c =
% 
%     69     0    15     0     6     9     0     1
%      0    88     0     0     4     5     3     0
%     31     2    43     0     3    10     6     5
%      1    14     2    48     3     7     6    19
%      6     8     5     0    49    17    12     3
%     27     2     7     1    12    40     5     6
%      3     9     2     9     8     8    49    12
%     12     5     5    14     7    11     7    39
% 
% 
% acc =
% 
%    53.1250
% 
% K=200
% 
% c =
% 
%     74     1    11     0     8     4     2     0
%      2    90     0     0     3     1     2     2
%     40     1    40     1     5     6     2     5
%      9     9     2    49     3     7     8    13
%     17     5     3     1    49    17     4     4
%     35     3     4     0    10    42     1     5
%      6     9     4     7     9    14    39    12
%     16     5     6    14     6     7     3    43
% 
% 
% acc =
% 
%    53.2500
% 
% K=400
% 
% c =
% 
%     78     0     9     0     5     5     0     3
%      2    92     1     0     1     0     0     4
%     33     3    46     0     1     8     1     8
%      9    11     3    43     1     3     4    26
%     21    18     4     0    27    18     4     8
%     48     6     4     0     7    28     0     7
%     10    22     8     8     8     6    16    22
%     19     8     6     6     2     3     2    54
% 
% 
% acc =
% 
%    48
% 
% K=800
% 
% c =
% 
%     82     0     8     0     0     2     0     8
%      4    85     0     0     1     1     0     9
%     61     1    28     0     1     2     0     7
%     19    11     2    29     1     2     0    36
%     47    14     5     0     7     7     0    20
%     66     9     2     0     2    11     0    10
%     20     5     7     3     2     3     2    58
%     37     3     3     1     0     1     0    55
% 
% 
% acc =
% 
%    37.3750
% 
% K=1600
% 
% c =
% 
%     96     0     4     0     0     0     0     0
%     24    72     1     0     0     0     0     3
%     87     1    10     0     0     0     0     2
%     67     6     5     7     0     0     0    15
%     84     4     3     0     1     4     0     4
%     94     1     1     0     0     2     0     2
%     81     1     9     0     0     0     0     9
%     61     4     2     2     1     1     0    29
% 
% 
% acc =
% 
%    27.1250